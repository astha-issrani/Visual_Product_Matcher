<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script defer src="client.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <title>Visual Product Matcher</title>
  </head>
  <body>
    <header>
      <nav class="navbar sticky-top bg-white border-bottom shadow-sm">
        <div class="container d-flex justify-content-between align-items-center py-2">
          <a class="Shop navbar-brand fs-3 fw-bold text-purple" href="/">
            Visual Product Matcher
          </a>
        </div>
      </nav>
    </header>

    <main class="container my-4 bg-white rounded-3 p-4 shadow-sm" style="max-width: 900px;">
      <h1 class="mb-3">Welcome!</h1>
      <p>Enter any image URL or upload any image file you want to search</p>

      <form id="similarityForm" class="d-flex flex-wrap align-items-center gap-3 mb-4">
        <label for="searchImageUpload" class="fw-semibold mb-0">Upload a file:</label>
        <input
          type="file"
          id="searchImageUpload"
          name="searchImage"
          accept="image/*"
          class="form-control form-control-sm"
          style="max-width: 250px;"
        />

        <label for="searchImageUrl" class="fw-semibold mb-0 ms-3">...or enter an image URL:</label>
        <input
          type="text"
          id="searchImageUrl"
          placeholder="e.g., https://example.com/image.jpg"
          class="form-control form-control-sm"
          style="max-width: 400px;"
        />

        <button type="submit" class="btn btn-primary btn-sm ms-3">Search</button>
      </form>

      <div id="loadingState" style="display:none; text-align:center;">
        <h3 class="mt-3">Processing Image...</h3>
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <div class="text-center my-4">
          <img
            id="uploadedImagePreview"
            src=""
            alt="Uploaded Image Preview"
            class="img-thumbnail"
            style="max-width: 300px; max-height: 300px; display: none;"
          />
      </div>

      <div id="filterContainer" class="mb-4" style="display:none;">
        <label for="scoreFilter" class="form-label">
          Minimum similarity score: <span id="scoreValue">0.40</span>
        </label>
        <input
          type="range"
          id="scoreFilter"
          min="0"
          max="1"
          step="0.01"
          value="0.40"
          class="form-range"
        />
      </div>

      <h3>Similar Products:</h3>
      <div id="searchResults" class="products row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4"></div>

      <div id="originalProducts" class="products row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4 mt-4">
        <% products.products.forEach(function(p) { %>
        <div class="product col" style="width:245px;">
          <div class="card h-100 shadow-sm">
            <img
              src="<%= p.thumbnail %>"
              class="card-img-top"
              alt="<%= p.title %>"
              style="height: 200px; object-fit: cover; border-radius: 0.5rem 0.5rem 0 0;"
            />
            <div class="card-body d-flex flex-column justify-content-between">
              <div>
                <% if (p.discountPercentage > 0) { %>
                <h6 class="text-muted text-decoration-line-through mb-1"><%= p.price %>€</h6>
                <div class="d-flex align-items-center gap-2 mb-2">
                  <h5 class="text-primary mb-0">
                    <%= Math.round((100-p.discountPercentage)/100*p.price) %>€</h5>
                  <span class="badge bg-purple">-<%= p.discountPercentage %>%</span>
                </div>
                <% } else { %>
                <h5 class="text-primary mb-2"><%= p.price %>€</h5>
                <% } %>
                <h6 class="card-title"><%= p.title %></h6>
              </div>
              <a href="/products/<%= p.id %>" class="btn btn-primary mt-3">Info</a>
            </div>
          </div>
        </div>
        <% }); %>
      </div>
    </main>

    <footer class="bg-dark text-white text-center py-3 mt-auto">
      <p class="mb-0">© 2025 visual_product_matcher</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <style>
      .text-purple { color: #b53cfb !important; }
      .bg-purple { background-color: #b53cfb !important; }
      .Shop:hover { color: #9043e9 !important; }
    </style>
  </body>
</html>